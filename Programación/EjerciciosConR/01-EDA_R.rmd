# ==========================================
# üß† EDA Spotify Tracks 2023 en R
# Autor: Jos√© Manuel S√°nchez √Ålvarez
# Curso: 2025‚Äì2026
# ==========================================

# 1Ô∏è‚É£ Cargar librer√≠as ----
library(tidyverse)   # Incluye dplyr, ggplot2, readr, etc.
library(ggcorrplot)  # Para el mapa de correlaciones
library(scales)      # Para formatear ejes

# 2Ô∏è‚É£ Cargar el dataset ----
spotify <- read_csv("spotify_tracks_2023.csv")

# 3Ô∏è‚É£ Vista previa ----
head(spotify)
glimpse(spotify)
summary(spotify)

# 4Ô∏è‚É£ Limpieza b√°sica ----
# Quitar columna no necesaria
spotify <- spotify %>% select(-`Unnamed:_0`)

# Eliminar duplicados
spotify <- spotify %>% distinct()

# Comprobar nulos
colSums(is.na(spotify))

# 5Ô∏è‚É£ Estad√≠sticas descriptivas ----
# Popularidad
summary(spotify$popularity)

# Duraci√≥n (en minutos)
spotify <- spotify %>%
  mutate(duration_min = duration_ms / 60000)

summary(spotify$duration_min)

# 6Ô∏è‚É£ Visualizaci√≥n b√°sica ----
# Histograma de popularidad
ggplot(spotify, aes(x = popularity)) +
  geom_histogram(binwidth = 5, fill = "steelblue", color = "white") +
  labs(title = "Distribuci√≥n de popularidad de canciones", x = "Popularidad", y = "Frecuencia")

# Boxplot duraci√≥n
ggplot(spotify, aes(y = duration_min)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Duraci√≥n de canciones (minutos)")

# 7Ô∏è‚É£ Correlaci√≥n entre variables num√©ricas ----
numeric_cols <- spotify %>%
  select(popularity, danceability, energy, loudness, speechiness,
         acousticness, instrumentalness, liveness, valence, tempo)

corr_matrix <- cor(numeric_cols, use = "complete.obs")

ggcorrplot(corr_matrix, hc.order = TRUE, type = "lower",
           lab = TRUE, lab_size = 3,
           colors = c("red", "white", "blue"),
           title = "Mapa de correlaciones entre atributos musicales")

# 8Ô∏è‚É£ An√°lisis por g√©nero ----
genre_stats <- spotify %>%
  group_by(track_genre) %>%
  summarise(media_pop = mean(popularity),
            media_dance = mean(danceability),
            n = n()) %>%
  arrange(desc(media_pop))

# Top 10 g√©neros
head(genre_stats, 10)

ggplot(genre_stats[1:10,], aes(x = reorder(track_genre, media_pop), y = media_pop)) +
  geom_col(fill = "purple") +
  coord_flip() +
  labs(title = "Top 10 g√©neros por popularidad media",
       x = "G√©nero", y = "Popularidad media")

# 9Ô∏è‚É£ Top artistas ----
top_artistas <- spotify %>%
  group_by(artists) %>%
  summarise(canciones = n(),
            popularidad_media = mean(popularity)) %>%
  arrange(desc(popularidad_media)) %>%
  head(10)

print(top_artistas)

ggplot(top_artistas, aes(x = reorder(artists, popularidad_media), y = popularidad_media)) +
  geom_col(fill = "orange") +
  coord_flip() +
  labs(title = "Top 10 artistas por popularidad media",
       x = "Artista", y = "Popularidad media")

# üîü Conclusiones preliminares ----
# - La mayor√≠a de canciones duran entre 2 y 4 minutos.
# - La popularidad se concentra en valores medios-altos.
# - Los g√©neros con m√°s energ√≠a tienden a ser m√°s populares.
# - Existen correlaciones moderadas entre energ√≠a, danceability y valence.
